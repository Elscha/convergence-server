version: 1
description: Initial Schema Creation
changes:

########## User Class ##########

  - action: CreateClass
    name: User
    properties: 
      - {name: username,    type: String,   constraints: {mandatory: true, notNull: true}}
      - {name: email,       type: String,   constraints: {mandatory: true, notNull: true}}
      - {name: firstName,   type: String,   constraints: {mandatory: true, notNull: true}}
      - {name: lastName,    type: String,   constraints: {mandatory: true, notNull: true}}
      - {name: displayName, type: String,   constraints: {mandatory: true, notNull: true}}

  - action: CreateIndex
    className: User
    name: User.username
    type: Unique
    properties: [username]

  - action: CreateIndex
    className: User
    name: User.email
    type: Unique
    properties: [email]
    
########## UserCredential Class ##########

  - action: CreateClass
    name: UserCredential
    properties: 
      - {name: user,     type: Link,   linkedClass: User, constraints: {mandatory: true, notNull: true}}
      - {name: password, type: String,                    constraints: {mandatory: true, notNull: true}}
          
  - action: CreateIndex
    className: UserCredential
    name: UserCredential.user
    type: Unique
    properties: [user]
    
######### Login History ##########

  - action: CreateClass
    name: LoginHistory
    properties:
      - {name: user,       type: Link,    linkedClass: User, constraints: {mandatory: true, notNull: true}} 
      - {name: timestamp,  type: DateTime,                   constraints: {mandatory: true, notNull: true}}
      - {name: success,    type: Boolean,                    constraints: {mandatory: true, notNull: true}}
      - {name: remoteHost, type: String,                     constraints: {mandatory: true, notNull: true}}
          
  - action: CreateIndex
    className: LoginHistory
    name: LoginHistory.user
    type: NotUniqueHashIndex
    properties: [user]
    
########## UserAuthToken Class ##########

  - action: CreateClass
    name: UserAuthToken
    properties: 
      - {name: user,       type: Link,     linkedClass: User, constraints: {mandatory: true, notNull: true}}
      - {name: token,      type: String,                      constraints: {mandatory: true, notNull: true}}
      - {name: expireTime, type: DateTime,                    constraints: {mandatory: true, notNull: true}}
          
########## Domain Class ##########

  - action: CreateClass
    name: Domain
    properties: 
      - {name: namespace,     type: String,                    constraints: {mandatory: true, notNull: true}}
      - {name: id,            type: String,                    constraints: {mandatory: true, notNull: true}}
      - {name: displayName,   type: String,                    constraints: {mandatory: true, notNull: true}}
      - {name: owner,         type: Link,   linkedClass: User, constraints: {mandatory: true, notNull: true}}
      - {name: status,        type: String,                    constraints: {mandatory: true, notNull: true}}
      - {name: statusMessage, type: String,                    constraints: {mandatory: true, notNull: true}}
          
  - action: CreateIndex
    className: Domain
    name: Domain.namespace_id
    type: UniqueHashIndex
    properties: [namespace, id]
    
########## Domain Database ##########

  - action: CreateClass
    name: DomainDatabase
    properties: 
      - {name: domain,        type: Link,   linkedClass: Domain, constraints: {mandatory: true, notNull: true}}
      - {name: database,      type: String,                      constraints: {mandatory: true, notNull: true}}
      - {name: username,      type: String,                      constraints: {mandatory: true, notNull: true}}
      - {name: password,      type: String,                      constraints: {mandatory: true, notNull: true}}
      - {name: adminUsername, type: String,                      constraints: {mandatory: true, notNull: true}}
      - {name: adminPassword, type: String,                      constraints: {mandatory: true, notNull: true}} 
          
  - action: CreateIndex
    className: DomainDatabase
    name: DomainDatabase.database
    type: Unique
    properties: [database]

  - action: CreateIndex
    className: DomainDatabase
    name: DomainDatabase.domain
    type: UniqueHashIndex
    properties: [domain]
    
########## Registration Class ##########

  - action: CreateClass
    name: Registration
    properties: 
      - {name: email,    type: String,  constraints: {mandatory: true, notNull: true}}
      - {name: fname,    type: String,  constraints: {mandatory: true, notNull: true}}
      - {name: lname,    type: String,  constraints: {mandatory: true, notNull: true}}
      - {name: reason,   type: String,  constraints: {mandatory: true, notNull: true}}
      - {name: token,    type: String,  constraints: {mandatory: true, notNull: true}}
      - {name: approved, type: Boolean, constraints: {mandatory: true, notNull: true}}
          
  - action: CreateIndex
    className: Registration
    name: Registration.email
    type: Unique
    properties: [email]

  - action: CreateIndex
    className: Registration
    name: Registration.email_token
    type: Unique
    properties: [email, token]
    
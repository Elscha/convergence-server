version: 2
description: Enhances the domain database management in the Convergence schema.
changes:

########## DomainDelta Class ##########

  - action: CreateClass
    name: DomainDelta
    properties: 
      - {name: deltaNo, type: Integer, constraints: {mandatory: true, notNull: true}}
      - {name: delta,   type: String,  constraints: {mandatory: true, notNull: true}}

  - action: CreateIndex
    className: DomainDelta
    name: DomainDelta.deltaNo
    type: Unique
    properties: [deltaNo]

########## DomainDeltaHistory Class ##########

  - action: CreateClass
    name: DomainDeltaHistory
    properties: 
      - {name: domain,  type: Link,    linkedClass: Domain,      constraints: {mandatory: true, notNull: true}}
      - {name: delta,   type: Link,    linkedClass: DomainDelta, constraints: {mandatory: true, notNull: true}}
      - {name: status,  type: String,                            constraints: {mandatory: true, notNull: true}}
      - {name: message, type: String}
      - {name: date,    type: DateTime,                          constraints: {notNull: true}}

  - action: CreateIndex
    className: DomainDeltaHistory
    name: DomainDeltaHistory.domain_delta
    type: Unique
    properties: [domain, delta]
    
########## ConvergenceDelta Class ##########

  - action: CreateClass
    name: ConvergenceDelta
    properties: 
      - {name: deltaNo, type: Integer, constraints: {mandatory: true, notNull: true}}
      - {name: delta,   type: String,  constraints: {mandatory: true, notNull: true}}    

  - action: CreateIndex
    className: ConvergenceDelta
    name: ConvergenceDelta.deltaNo
    type: Unique
    properties: [deltaNo]

########## ConvergenceDeltaHistory Class ##########

  - action: CreateClass
    name: ConvergenceDeltaHistory
    properties: 
      - {name: delta,   type: Link,     linkedClass: ConvergenceDelta, constraints: {mandatory: true, notNull: true}}
      - {name: status,  type: String,                                  constraints: {mandatory: true, notNull: true}}
      - {name: message, type: String}
      - {name: date,    type: DateTime,                                constraints: {notNull: true}}

  - action: CreateIndex
    className: ConvergenceDeltaHistory
    name: ConvergenceDeltaHistory.delta
    type: Unique
    properties: [delta]

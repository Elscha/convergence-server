version: 2
description: Schema to add roles and permissions
changes:


########## Permission Class ##########

  - action: CreateClass
    name: Permission
    properties:
      - {name: id,          type: String, constraints: {mandatory: true, notNull: true, readOnly: true}}
      - {name: name,        type: String, constraints: {mandatory: true, notNull: true, readOnly: true}}
      - {name: description, type: String, constraints: {mandatory: true, notNull: true, readOnly: true}}

  - action: CreateIndex
    className: Permission
    name: Permission.id
    type: Unique
    properties: [id]

  - action: CreateIndex
    className: Permission
    name: Permission.name
    type: Unique
    properties: [name]


########## Role Class ##########

  - action: CreateClass
    name: Role
    properties:
      - {name: name,        type: String,                            constraints: {mandatory: true, notNull: true, readOnly: true}}
      - {name: permissions, type: LinkList, linkedClass: Permission, constraints: {mandatory: true, notNull: true}}
      - {name: description, type: String,                            constraints: {mandatory: true, notNull: true, readOnly: true}}

  - action: CreateIndex
    className: Role
    name: Role.id
    type: Unique
    properties: [name]

########## UserDomainRole Class ##########

  - action: CreateClass
    name: UserDomainRole
    properties:
      - {name: user,   type: Link, linkedClass: User,   constraints: {mandatory: true, notNull: true, readOnly: true}}
      - {name: domain, type: Link, linkedClass: Domain, constraints: {mandatory: true, notNull: true, readOnly: true}}
      - {name: role,   type: Link, linkedClass: Role,   constraints: {mandatory: true, notNull: true, readOnly: true}}

  - action: CreateIndex
    className: UserDomainRole
    name: UserDomainRole.user_domain_role
    type: Unique
    properties: [user, domain, role]
